<html>
    <head>
        <title>code converter</title>
        <link rel="stylesheet" href="/style/sweetalert.css">
        <style type="text/css">
          div#cmdDiv {
            margin-bottom: 1%;
          }
          div#contentDiv {
            width: 100%;
          }
          textarea#lTextArea {
            width: 100%;
          }
          textarea#rTextArea {
            width: 100%;
          }
          table {
            width: 100%;
          }
          td {
            width: 45%;
          }
        </style>
        <script type="text/javascript" src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script type="text/javascript" src="/scripts/sweetalert.min.js"></script>
        <script type="text/javascript">
          var codecScriptsMap = {
            "base64": {
              url: "/scripts/codec/base64.min.js",
              ready: false,
              encode: function(source, ext) {
                return Base64.encode(source);
              },
              decode: function(target, ext) {
                return Base64.decode(target);
              }
            },
            "crc32": {
              url: "/scripts/codec/crc32.js",
              ready: false,
              encode: function(source, ext) {
                return CRC32.bstr(source);
              },
              decode: function(target, ext) {
                sweetAlert("Oops...", "Not support decoding CRC32", "error");
              },
            }
          };

          $(function() {
            var convertL2RButton = $("input#convertL2R");
            var convertR2LButton = $("input#convertR2L");
            var codecSelect = $("select#codecSelect");
            var lTextArea = $("textarea#lTextArea");
            var rTextArea = $("textarea#rTextArea");

            // porpulate codecSelect options
              codecSelect.append("<option value='' selected>""</option>");
            for (key in codecScriptsMap) {
              codecSelect.append("<option value='" + key + "'>" + key + "</option>");
            }

            codecSelect.change(function() {
              convertR2LButton.prop('disabled', true);
              convertL2RButton.prop('disabled', true);

              var codec = codecSelect.val();
              if (codec !== "") {
                if ((!codecScriptsMap[codec].ready) && (codecScriptsMap[codec].url !== null)) {
                  $.getScript(codecScriptsMap[codec].url);
                  codecScriptsMap[codec].ready = true;
                }
              }
              
              convertR2LButton.prop('disabled', false);
              convertL2RButton.prop('disabled', false);
            });

            
            var convert = function(codec, operation, sourceTextArea, targetTextArea) {
              if (codec === "") {
                sweetAlert("Oops...", "Please select codec at first!", "error");
                return;
              }
              var source = $(sourceTextArea).val();
              var target = null;
              if (source !== null) {
                target = codecScriptsMap[codec][operation](source);
              }
              $(targetTextArea).val(target);
            };
            convertL2RButton.click(function() {
              var codec = codecSelect.val();
              convert(codec, "encode", lTextArea, rTextArea);
            })
            convertR2LButton.click(function() {
              var codec = codecSelect.val();
              convert(codec, "decode", rTextArea, lTextArea);
            })

            
          });
        </script>
    </head>
    <body>
        <h1>Code converter</h1>
        <hr>
        <div id="cmdDiv">
          <label>codec:</label>
          <select id="codecSelect">
          </select>
        </div>
        <br>
        <div id="contentDiv">
          <table>
            <tr>
              <td><input id="convertL2R" class="converter" type="button" value="encode"></td>
              <td><input id="convertR2L" class="converter" type="button" value="decode"></td>
            </tr>
            <tr>
              <td><textarea id="lTextArea" rows="30"></textarea></td>
              <td><textarea id="rTextArea" rows="30"></textarea></td>
            </tr>
          </table>
        </div>
    </body>    
</html>
